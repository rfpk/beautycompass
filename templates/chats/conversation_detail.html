{% extends 'base.html' %}
{% load static %}

{% block title %}Личный Кабинет{% endblock %}


{% block content %}
<main class="discourse">

    <section class="discourse-post">
        <div class="container container--bc">
            <div class="col-xxl-10 offset-xxl-1">

                <div class="discourse-post__item d-flex flex-column gap-2 gap-lg-3">
                    <div class="discourse-post__head d-flex">
                        
                        <div class="feed__user align-items-center">
                            <a href="{% url 'profile:author-profile' post.author_id %}" class="feed__avatar">
                                {% if post.profile.avatar %}
                                    <img src="{{post.profile.avatar.url}}" alt="avatar" />
                                {% endif %}
                            </a>
                            <div class="feed__info">
                                <a href="{% url 'profile:author-profile' post.author_id %}" class="feed__name">{{post.profile.first_name}} {{post.profile.last_name_slice}}.</a>
                                <div class="d-flex align-items-center gap-2">
                                    <div class="feed__date">{{post.created_at|date:'d.m.Y'}}</div>
                                </div>
                            </div>
                        </div>

                    </div>
                    <div class="discourse-post__title text--20-30 dark-semi fw-600 lh-125">
                        {{post.title}}
                    </div>
                    <div class="discourse-post__text fw-600 text--12-18">
                        {{post.text|safe}}
                    </div>
                    {% if post.post_conversation_images.all %}
                        <section
                            id="feed-image-slider"
                            class="feed__splide splide"
                            aria-label="Feed slides"
                        >
                            <div class="splide__track">
                            <div class="splide__list">
                                {% for image in post.post_conversation_images.all %}
                                    <div class="splide__slide">
                                        <img
                                            src="{{image.image.url}}"
                                            alt="review-photo"
                                            data-modal-image
                                        />
                                    </div>
                                {% endfor %}
                            </div>
                            </div>
                        </section>
                    {% endif %}
                    {% if post.tag.all %}
                        <div class="discourse-post__tags">
                            <div class="row">
                                <div class="col-12 mb-2 tag-links">
                                    {% for tag in post.tag.all %}
                                        <a href="#" class="tag">{{ tag }}</a>
                                    {% endfor %}
                                </div>
                            </div>
                        </div>
                    {% endif %}
                    <div class="social-count text--15-30 dark-semi">
                        <div class="social-count__group">

                            <div class="social-count__item">
                                <div class="social-count__icon social-count__icon--fav" onclick="onClickActive(this)">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="38px" height="38px" viewBox="0 0 9.69506 8.58706">
                                        <path fill="#E31E24" d="M4.84758 8.58706c-0.139836,0 -0.275091,-0.0177795 -0.387876,-0.0579197 -1.72254,-0.582796 -4.45971,-2.65165 -4.45971,-5.70831 0,-1.55729 1.27609,-2.82083 2.84537,-2.82083 0.762118,0 1.47461,0.293634 2.00221,0.81862 0.527495,-0.524986 1.23998,-0.81862 2.0021,-0.81862 1.56929,0 2.84537,1.26802 2.84537,2.82083 0,3.06102 -2.73717,5.12551 -4.45971,5.70831 -0.112785,0.0401402 -0.24804,0.0579197 -0.387767,0.0579197zm-2.00221 -7.91962c-1.19493,0 -2.16899,0.965437 -2.16899,2.15339 0,3.03877 2.96263,4.72956 4.00431,5.08101 0.081153,0.0267238 0.256985,0.0267238 0.338247,0 1.0371,-0.351445 4.00431,-2.03777 4.00431,-5.08101 0,-1.18795 -0.974054,-2.15339 -2.1691,-2.15339 -0.685438,0 -1.32125,0.315886 -1.73159,0.863123 -0.126202,0.169069 -0.414818,0.169069 -0.541129,0 -0.419291,-0.55171 -1.05063,-0.863123 -1.73606,-0.863123z"/>
                                        <path class="icon-inner" fill="none" d="M2.78625 0.583124c-1.22297,0 -2.21982,0.983217 -2.21982,2.19309 0,3.09472 3.03211,4.81671 4.09823,5.1747 0.0831164,0.0271601 0.262984,0.0271601 0.346209,0 1.06142,-0.357989 4.09823,-2.0754 4.09823,-5.1747 0,-1.20988 -0.996851,-2.19309 -2.21993,-2.19309 -0.701581,0 -1.35233,0.321667 -1.77228,0.879049 -0.129147,0.172123 -0.424526,0.172123 -0.553782,0 -0.429107,-0.561854 -1.07528,-0.879049 -1.77686,-0.879049z"/>
                                    </svg>
                                </div>
                                <div class="social-count__count">{{post.favorite_count}}</div>
                            </div>

                            <div class="social-count__item">
                                <div class="social-count__icon social-count__icon--like" onclick="onClickActive(this)">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="38px" height="39px" viewBox="0 0 22.2825 21.6998">
                                        <path fill="#1560BD" d="M15.736 21.6998l-4.08184 0c-0.601234,0 -1.91179,-0.182397 -2.60994,-0.880805l-2.29113 -1.76914c-0.392855,0.984735 -1.29445,1.46905 -2.72504,1.46905l-1.07411 0c-1.9874,0 -2.95394,-0.934589 -2.95394,-2.84664l0 -10.5263c0,-1.91205 0.966547,-2.84638 2.95394,-2.84638l1.07411 0c1.52595,0 2.44988,0.551347 2.79675,1.67301l3.19688 -4.75635c0.676843,-1.00968 2.15888,-1.49321 3.31874,-1.05281 1.34277,0.440402 2.20201,1.9227 1.9014,3.29769l-0.526404 3.38369c-0.0106528,0.0750893 -0.0106528,0.182397 0.0644365,0.268399 0.0537837,0.0537837 0.128873,0.0860019 0.214875,0.0860019l4.29672 0c1.05255,0 1.96557,0.440402 2.50263,1.20299 0.526404,0.741019 0.633712,1.71874 0.289964,2.66398l-2.56707 7.81942c-0.397531,1.55739 -2.05183,2.81416 -3.78097,2.81416zm-8.75427 -4.51445l3.12595 2.42c0.268399,0.257746 0.945241,0.472621 1.54648,0.472621l4.08184 0c0.966547,0 2.00844,-0.773497 2.22332,-1.64339l2.59954 -7.89477c0.171744,-0.472621 0.139526,-0.90237 -0.0860019,-1.2139 -0.23618,-0.332835 -0.66593,-0.526145 -1.19233,-0.526145l-4.29646 0c-0.558623,0 -1.07437,-0.23644 -1.42877,-0.644624 -0.365053,-0.418837 -0.526145,-0.97746 -0.440402,-1.55739l0.537057 -3.44813c0.129133,-0.601494 -0.279051,-1.27808 -0.859239,-1.47139 -0.526404,-0.193569 -1.20299,0.0857421 -1.43943,0.42949l-4.37155 6.50471 0 8.57291zm-4.0278 -11.2746c-1.17103,0 -1.34277,0.279311 -1.34277,1.23521l0 10.5263c0,0.956154 0.171744,1.23547 1.34277,1.23547l1.07411 0c1.17077,0 1.34251,-0.279311 1.34251,-1.23547l0 -10.5263c0,-0.955894 -0.171744,-1.23521 -1.34251,-1.23521l-1.07411 0z"/>
                                        <path class="icon-inner" fill="none" d="M2.77908 5.68106c-1.31289,0 -1.50542,0.289185 -1.50542,1.2786l0 10.8963c0,0.989671 0.19253,1.27886 1.50542,1.27886l1.20455 0c1.31263,0 1.50516,-0.289185 1.50516,-1.27886l0 -10.8963c0,-0.989412 -0.19253,-1.2786 -1.50516,-1.2786l-1.20455 0z"/>
                                        <path class="icon-inner" fill="none" d="M6.98174 17.1853l3.23378 2.56083c0.270477,0.261124 0.953036,0.479116 1.55921,0.479116l4.11536 -0.000259824c0.974342,0.000259824 2.02481,-0.78415 2.24177,-1.66625l2.62085 -8.00623c0.173043,-0.479376 0.140825,-0.915102 -0.0865215,-1.23105 -0.238259,-0.337252 -0.671646,-0.533679 -1.20221,-0.533679l-4.33205 0c-0.563299,0 -1.08321,-0.239818 -1.44047,-0.653718 -0.368171,-0.424553 -0.530302,-0.99123 -0.44404,-1.57921l0.541474 -3.49698c0.130172,-0.609808 -0.28139,-1.296 -0.866255,-1.49217 -0.530821,-0.196167 -1.29964,0.151737 -1.53816,0.500162l-3.5188 5.23053 -0.883923 1.31601c0,2.08379 0,3.2899 0,1.50724l0 4.21903c0,0.782591 0,1.33758 0,2.84664z"/>
                                    </svg>                                                  
                                </div>
                                <div class="social-count__count">{{post.likes_count}}</div>
                            </div>

                        </div>
                        
                        <div class="social-count__item">
                            <div class="social-count__icon">
                                <svg width="38" height="37" viewBox="0 0 38 37" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M19 25.1751C15.2656 25.1751 12.2344 22.1842 12.2344 18.4996C12.2344 14.8151 15.2656 11.8242 19 11.8242C22.7344 11.8242 25.7656 14.8151 25.7656 18.4996C25.7656 22.1842 22.7344 25.1751 19 25.1751ZM19 14.1367C16.5625 14.1367 14.5781 16.0946 14.5781 18.4996C14.5781 20.9046 16.5625 22.8626 19 22.8626C21.4375 22.8626 23.4219 20.9046 23.4219 18.4996C23.4219 16.0946 21.4375 14.1367 19 14.1367Z" fill="#494949"/>
                                    <path d="M19 32.4054C13.125 32.4054 7.57812 29.0138 3.76562 23.1246C2.10938 20.5808 2.10938 16.4337 3.76562 13.8746C7.59375 7.98542 13.1406 4.59375 19 4.59375C24.8594 4.59375 30.4062 7.98542 34.2188 13.8746C35.875 16.4183 35.875 20.5654 34.2188 23.1246C30.4062 29.0138 24.8594 32.4054 19 32.4054ZM19 6.90625C13.9531 6.90625 9.125 9.89708 5.75 15.1233C4.57812 16.9271 4.57812 20.0721 5.75 21.8758C9.125 27.1021 13.9531 30.0929 19 30.0929C24.0469 30.0929 28.875 27.1021 32.25 21.8758C33.4219 20.0721 33.4219 16.9271 32.25 15.1233C28.875 9.89708 24.0469 6.90625 19 6.90625Z" fill="#494949"/>
                                </svg>
                            </div>
                            <div class="social-count__count">{{post.views_count}}</div>
                        </div>
                    </div>
                    <div class="discourse-post__banner">
                        <!-- <img src="../img/image 198.png" class="w-100" alt=""> -->
                        <div id="carouselProduct" class="carousel carousel--base slide b-carousel carousel-fade" data-bs-ride="carousel">
                            <div class="carousel-indicators">
                                {% for _ in selection_banners %}
                                    <button type="button" data-bs-target="#carouselSelection"
                                            data-bs-slide-to="{{ forloop.counter0 }}"
                                            aria-label="Slide {{ forloop.counter }}"></button>
                                {% endfor %}
                            </div>
                            <div class="carousel-inner">
                                {% for banner in selection_banners %}
                                    <div class="carousel-item">
                                        <a href="{% url 'landing:landing_page' 'o-proekte' %}">
                                            <img src="{{ banner.banner.url }}" class="d-block w-100" alt="...">
                                        </a>
                                    </div>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </section>


    <section class="discourse-comments mt-4 mt-xxl-5">
        <div class="container container--bc">
            <div class="col-xxl-10 offset-xxl-1">

                <div class="discourse-comments__list position-relative mb-4">
                    <div class="discourse-comments__aside">
                        <div class="discourse-comments__controls">
                            <a style="cursor: pointer;" class="discourse-comments__controls__icon discourse-comments__controls__icon--count" href="#">
                                <span>0</span>
                            </a>
                            <a style="cursor: pointer;" class="discourse-comments__controls__icon discourse-comments__controls__icon--reload">
                                <img src="{% static "img/reload.svg" %}" alt="">
                            </a>
                        </div>
                    </div>

                    <h3 class="text--15-30 dark-semi mb-2 mb-xl-2">Комментарии ({{post.comments__count}})</h3>

                    
                    <div id="list-comments">
                        {% for comment in post.comments.all %}
                        {% if not comment.parent %}
                            <div class="discourse__item mb-4">
                                <div class="feed d-flex flex-column mb-2 mb-lg-3 comment" data-comment-id="{{ comment.id }}">
                                    <div class="feed__row feed__row--blue">
                                        <div class="feed__user align-items-center">
                                            <a href="{% url 'profile:author-profile' comment.author.id %}" class="feed__avatar">
                                                {% if comment.author.profile.avatar %}
                                                    <img src="{{comment.author.profile.avatar.url}}" alt="avatar" />
                                                {% endif %}
                                            </a>
                                        <div class="feed__info">
                                            <a href="{% url 'profile:author-profile' comment.author.id %}" class="feed__name">{{comment.author.profile.first_name}} {{comment.author.profile.last_name_slice}}.</a>
                                            <div class="d-flex align-items-center gap-2">
                                                <div class="feed__date">{{comment.created_at|date:'d.m.Y'}}</div>
                                            </div>
                                        </div>
                                        </div>
                                        <div class="feed__text d-flex flex-column align-items-start gap-1 gap-lg-2 dark-semi mt-2 mb-3">
                                            <span class="feed__text feed__text--preview">
                                                {{comment.text|safe}}
                                            </span>
                                        </div>
                                        {% if comment.comment_conversation_images %}
                                            <section
                                                id="feed-image-slider"
                                                class="feed__splide splide"
                                                aria-label="Feed slides"
                                            >
                                                <div class="splide__track">
                                                    <div class="splide__list">
                                                        {% for photo in comment.comment_conversation_images.all %}
                                                            <div class="splide__slide">
                                                                <img
                                                                    src="{{photo.image.url}}"
                                                                    alt="review-photo"
                                                                    data-modal-image
                                                                />
                                                            </div>
                                                        {% endfor %}
                                                    </div>
                                                </div>
                                            </section>
                                        {% endif %}

                                        <div class="feed__actions justify-content-between">
                                            <button
                                            type="button"
                                            class="feed__action social-count__icon social-count__icon--small social-count__icon--like" onclick="onClickActive(this)"
                                            >
                                                <svg xmlns="http://www.w3.org/2000/svg" width="18px" height="19px" viewBox="0 0 22.2825 21.6998">
                                                    <path fill="#1560BD" d="M15.736 21.6998l-4.08184 0c-0.601234,0 -1.91179,-0.182397 -2.60994,-0.880805l-2.29113 -1.76914c-0.392855,0.984735 -1.29445,1.46905 -2.72504,1.46905l-1.07411 0c-1.9874,0 -2.95394,-0.934589 -2.95394,-2.84664l0 -10.5263c0,-1.91205 0.966547,-2.84638 2.95394,-2.84638l1.07411 0c1.52595,0 2.44988,0.551347 2.79675,1.67301l3.19688 -4.75635c0.676843,-1.00968 2.15888,-1.49321 3.31874,-1.05281 1.34277,0.440402 2.20201,1.9227 1.9014,3.29769l-0.526404 3.38369c-0.0106528,0.0750893 -0.0106528,0.182397 0.0644365,0.268399 0.0537837,0.0537837 0.128873,0.0860019 0.214875,0.0860019l4.29672 0c1.05255,0 1.96557,0.440402 2.50263,1.20299 0.526404,0.741019 0.633712,1.71874 0.289964,2.66398l-2.56707 7.81942c-0.397531,1.55739 -2.05183,2.81416 -3.78097,2.81416zm-8.75427 -4.51445l3.12595 2.42c0.268399,0.257746 0.945241,0.472621 1.54648,0.472621l4.08184 0c0.966547,0 2.00844,-0.773497 2.22332,-1.64339l2.59954 -7.89477c0.171744,-0.472621 0.139526,-0.90237 -0.0860019,-1.2139 -0.23618,-0.332835 -0.66593,-0.526145 -1.19233,-0.526145l-4.29646 0c-0.558623,0 -1.07437,-0.23644 -1.42877,-0.644624 -0.365053,-0.418837 -0.526145,-0.97746 -0.440402,-1.55739l0.537057 -3.44813c0.129133,-0.601494 -0.279051,-1.27808 -0.859239,-1.47139 -0.526404,-0.193569 -1.20299,0.0857421 -1.43943,0.42949l-4.37155 6.50471 0 8.57291zm-4.0278 -11.2746c-1.17103,0 -1.34277,0.279311 -1.34277,1.23521l0 10.5263c0,0.956154 0.171744,1.23547 1.34277,1.23547l1.07411 0c1.17077,0 1.34251,-0.279311 1.34251,-1.23547l0 -10.5263c0,-0.955894 -0.171744,-1.23521 -1.34251,-1.23521l-1.07411 0z"/>
                                                    <path class="icon-inner" fill="none" d="M2.77908 5.68106c-1.31289,0 -1.50542,0.289185 -1.50542,1.2786l0 10.8963c0,0.989671 0.19253,1.27886 1.50542,1.27886l1.20455 0c1.31263,0 1.50516,-0.289185 1.50516,-1.27886l0 -10.8963c0,-0.989412 -0.19253,-1.2786 -1.50516,-1.2786l-1.20455 0z"/>
                                                    <path class="icon-inner" fill="none" d="M6.98174 17.1853l3.23378 2.56083c0.270477,0.261124 0.953036,0.479116 1.55921,0.479116l4.11536 -0.000259824c0.974342,0.000259824 2.02481,-0.78415 2.24177,-1.66625l2.62085 -8.00623c0.173043,-0.479376 0.140825,-0.915102 -0.0865215,-1.23105 -0.238259,-0.337252 -0.671646,-0.533679 -1.20221,-0.533679l-4.33205 0c-0.563299,0 -1.08321,-0.239818 -1.44047,-0.653718 -0.368171,-0.424553 -0.530302,-0.99123 -0.44404,-1.57921l0.541474 -3.49698c0.130172,-0.609808 -0.28139,-1.296 -0.866255,-1.49217 -0.530821,-0.196167 -1.29964,0.151737 -1.53816,0.500162l-3.5188 5.23053 -0.883923 1.31601c0,2.08379 0,3.2899 0,1.50724l0 4.21903c0,0.782591 0,1.33758 0,2.84664z"/>
                                                </svg>
                                                <span class="dark-semi">15</span>
                                            </button>
                                            {% if comment.profile.user != user %}
                                                <a href="#" class="main-color text--15-20 js-newAnswerBtn" name="{{comment.id}}">ответить</a>
                                            {% endif %}
                                        </div>

                                        {% if comment.profile.user == user %}
                                            <a href="#" class="feed__mark js-newAnswerBtn" name="{{comment.id}}">
                                                <svg width="39" height="38" viewBox="0 0 39 38" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                    <path d="M9.43976 30.5371C8.48729 30.5371 7.59729 30.2092 6.95711 29.6002C6.14517 28.8351 5.75482 27.6797 5.89535 26.4305L6.47307 21.3716C6.58237 20.4191 7.16009 19.1543 7.8315 18.4673L20.6507 4.89862C23.8516 1.51035 27.1931 1.41667 30.5813 4.61757C33.9696 7.81847 34.0633 11.1599 30.8624 14.5482L18.0432 28.1169C17.3874 28.8195 16.1695 29.4753 15.217 29.6314L10.1892 30.4902C9.9238 30.5058 9.68958 30.5371 9.43976 30.5371ZM25.6629 4.60195C24.4606 4.60195 23.4144 5.35143 22.3527 6.47565L9.53344 20.06C9.22116 20.3879 8.86204 21.1686 8.79958 21.6214L8.22185 26.6804C8.1594 27.1956 8.28431 27.6172 8.56537 27.8827C8.84642 28.1481 9.268 28.2418 9.78327 28.1637L14.811 27.3049C15.2638 27.2269 16.0133 26.8209 16.3256 26.493L29.1448 12.9243C31.081 10.8632 31.7836 8.9583 28.9575 6.3039C27.7083 5.10161 26.6309 4.60195 25.6629 4.60195Z" fill="#1560BD"/>
                                                    <path d="M27.8653 17.1558C27.8341 17.1558 27.7872 17.1558 27.756 17.1558C22.8844 16.6718 18.9652 12.9712 18.2158 8.13084C18.1221 7.49066 18.5593 6.89732 19.1995 6.78803C19.8396 6.69434 20.433 7.13154 20.5423 7.77172C21.1356 11.5503 24.196 14.4546 28.0058 14.8293C28.646 14.8918 29.1144 15.4695 29.052 16.1097C28.9739 16.703 28.4586 17.1558 27.8653 17.1558Z" fill="#1560BD"/>
                                                    <path d="M33.5773 35.5804H5.47184C4.83166 35.5804 4.30078 35.0495 4.30078 34.4093C4.30078 33.7692 4.83166 33.2383 5.47184 33.2383H33.5773C34.2175 33.2383 34.7484 33.7692 34.7484 34.4093C34.7484 35.0495 34.2175 35.5804 33.5773 35.5804Z" fill="#1560BD"/>
                                                </svg>
                                            </a>
                                        {% else %}
                                            <a href="#" class="feed__mark js-newReportBtn" type="button" data-bs-toggle="modal" data-bs-target="#modal-petition" type="button" data-bs-toggle="modal" data-bs-target="#modal-petition" data-post-id="{{post.id}}" data-comment-id="{{comment.id}}">
                                                <svg width="39" height="38" viewBox="0 0 39 38" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                    <path d="M19.4886 23.5222C18.8478 23.5222 18.3164 22.9914 18.3164 22.3512V14.5441C18.3164 13.9039 18.8478 13.373 19.4886 13.373C20.1293 13.373 20.6607 13.9039 20.6607 14.5441V22.3512C20.6607 22.9914 20.1293 23.5222 19.4886 23.5222Z" fill="#E31E24"/>
                                                    <path d="M19.4886 28.5974C19.3949 28.5974 19.2855 28.5818 19.1761 28.5662C19.0823 28.5506 18.9885 28.5194 18.8948 28.4725C18.801 28.4413 18.7072 28.3945 18.6134 28.332C18.5353 28.2695 18.4572 28.2071 18.379 28.1446C18.0977 27.848 17.9258 27.442 17.9258 27.036C17.9258 26.6301 18.0977 26.2241 18.379 25.9274C18.4572 25.865 18.5353 25.8025 18.6134 25.74C18.7072 25.6776 18.801 25.6307 18.8948 25.5995C18.9885 25.5527 19.0823 25.5214 19.1761 25.5058C19.3792 25.459 19.598 25.459 19.7856 25.5058C19.895 25.5214 19.9888 25.5527 20.0825 25.5995C20.1763 25.6307 20.2701 25.6776 20.3638 25.74C20.442 25.8025 20.5201 25.865 20.5983 25.9274C20.8796 26.2241 21.0515 26.6301 21.0515 27.036C21.0515 27.442 20.8796 27.848 20.5983 28.1446C20.5201 28.2071 20.442 28.2695 20.3638 28.332C20.2701 28.3945 20.1763 28.4413 20.0825 28.4725C19.9888 28.5194 19.895 28.5506 19.7856 28.5662C19.6918 28.5818 19.5824 28.5974 19.4886 28.5974Z" fill="#E31E24"/>
                                                    <path d="M28.9613 35.0932H10.0194C6.97181 35.0932 4.64315 33.9846 3.45537 31.986C2.28323 29.9874 2.43951 27.411 3.92423 24.741L13.3952 7.72158C14.958 4.91104 17.1148 3.36523 19.4903 3.36523C21.8659 3.36523 24.0226 4.91104 25.5855 7.72158L35.0565 24.7566C36.5412 27.4266 36.7131 29.9874 35.5253 32.0016C34.3375 33.9846 32.0089 35.0932 28.9613 35.0932ZM19.4903 5.70736C18.0213 5.70736 16.5834 6.83158 15.4425 8.86142L5.98721 25.8965C4.92446 27.8014 4.75255 29.5502 5.48709 30.8149C6.22164 32.0797 7.84702 32.7667 10.035 32.7667H28.9769C31.1649 32.7667 32.7747 32.0797 33.5249 30.8149C34.275 29.5502 34.0875 27.817 33.0247 25.8965L23.5382 8.86142C22.3973 6.83158 20.9594 5.70736 19.4903 5.70736Z" fill="#E31E24"/>
                                                </svg>
                                            </a>
                                        {% endif %}
                                    </div>
                                </div>
                                {% include "utils/nested_comments.html" with comments=post.comments.all parent=comment.pk type='conversation' %}
                            </div>
                        {% endif %}
                    {% endfor %}
                    </div>
                </div>
                
                <form action="{% url 'chats:create_conversation_comment' %}" method="post" class="my-3" enctype="multipart/form-data">
                    {% csrf_token %}
                    <textarea name="text" class="editor" placeholder="Оставить комментарий"></textarea>
                    <input type="hidden" name="post" value="{{post.id}}" />
                    <div class="profile__images profile__products-images banners__row mt-3">
                        <div class="banners banners__pic position-relative m-0">
                            <div class="input image input--image profile__input profile__image products__image profile__products-image profile__products-input">
                                <img src="{% static 'img/gallery-add.svg' %}" alt="logo" class="position-absolute top-50 start-50 translate-middle"/>
                                <input type="file" name="images" id="products__file-input" class="file-input profile__file-input products__file-input" onchange="handleFileSelected(this)"/>
                            </div>
                        </div>
        
                        <div class="profile__products-plus banners__plus">
                            <svg role="button" class="banners__plus-image hover-red" viewBox="0 0 26 26" fill="none"xmlns="http://www.w3.org/2000/svg" >
                                <path d="M12.9993 24.6452C6.57518 24.6452 1.35352 19.4235 1.35352 12.9993C1.35352 6.57518 6.57518 1.35352 12.9993 1.35352C19.4235 1.35352 24.6452 6.57518 24.6452 12.9993C24.6452 19.4235 19.4235 24.6452 12.9993 24.6452ZM12.9993 2.97852C7.47435 2.97852 2.97852 7.47435 2.97852 12.9993C2.97852 18.5243 7.47435 23.0202 12.9993 23.0202C18.5243 23.0202 23.0202 18.5243 23.0202 12.9993C23.0202 7.47435 18.5243 2.97852 12.9993 2.97852Z" fill="#1560BD"/>
                                <path d="M17.3327 13.8125H8.66602C8.22185 13.8125 7.85352 13.4442 7.85352 13C7.85352 12.5558 8.22185 12.1875 8.66602 12.1875H17.3327C17.7769 12.1875 18.1452 12.5558 18.1452 13C18.1452 13.4442 17.7769 13.8125 17.3327 13.8125Z" fill="#1560BD" />
                                <path d="M13 18.1452C12.5558 18.1452 12.1875 17.7769 12.1875 17.3327V8.66602C12.1875 8.22185 12.5558 7.85352 13 7.85352C13.4442 7.85352 13.8125 8.22185 13.8125 8.66602V17.3327C13.8125 17.7769 13.4442 18.1452 13 18.1452Z" fill="#1560BD" />
                            </svg>
                        </div>
                    </div>
        
        
                    <input type="submit" value="Отправить комментарий" class="btn btn--base mt-3">
                </form>
            </div>
        </div>
    </section>


</main>

<div id="imageModal" class="image-modal" style="z-index: 1000;">
    <span class="image-modal__close">&times;</span>
    <img class="image-modal__content" id="img01" />
</div>

<!-- Modal Petition-->
<div class="modal fade" id="modal-petition" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content modal-petition">

        <div class="modal-petition__header d-flex justify-content-between align-items-center mb-4 mb-xxl-5">
            <div class="text--15-36 fw700 pre-color text-uppercase">Отправить жалобу</div>
            <svg width="39" height="38" viewBox="0 0 39 38" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M19.4886 23.5222C18.8478 23.5222 18.3164 22.9914 18.3164 22.3512V14.5441C18.3164 13.9039 18.8478 13.373 19.4886 13.373C20.1293 13.373 20.6607 13.9039 20.6607 14.5441V22.3512C20.6607 22.9914 20.1293 23.5222 19.4886 23.5222Z" fill="#E31E24"/>
                <path d="M19.4886 28.5974C19.3949 28.5974 19.2855 28.5818 19.1761 28.5662C19.0823 28.5506 18.9885 28.5194 18.8948 28.4725C18.801 28.4413 18.7072 28.3945 18.6134 28.332C18.5353 28.2695 18.4572 28.2071 18.379 28.1446C18.0977 27.848 17.9258 27.442 17.9258 27.036C17.9258 26.6301 18.0977 26.2241 18.379 25.9274C18.4572 25.865 18.5353 25.8025 18.6134 25.74C18.7072 25.6776 18.801 25.6307 18.8948 25.5995C18.9885 25.5527 19.0823 25.5214 19.1761 25.5058C19.3792 25.459 19.598 25.459 19.7856 25.5058C19.895 25.5214 19.9888 25.5527 20.0825 25.5995C20.1763 25.6307 20.2701 25.6776 20.3638 25.74C20.442 25.8025 20.5201 25.865 20.5983 25.9274C20.8796 26.2241 21.0515 26.6301 21.0515 27.036C21.0515 27.442 20.8796 27.848 20.5983 28.1446C20.5201 28.2071 20.442 28.2695 20.3638 28.332C20.2701 28.3945 20.1763 28.4413 20.0825 28.4725C19.9888 28.5194 19.895 28.5506 19.7856 28.5662C19.6918 28.5818 19.5824 28.5974 19.4886 28.5974Z" fill="#E31E24"/>
                <path d="M28.9613 35.0932H10.0194C6.97181 35.0932 4.64315 33.9846 3.45537 31.986C2.28323 29.9874 2.43951 27.411 3.92423 24.741L13.3952 7.72158C14.958 4.91104 17.1148 3.36523 19.4903 3.36523C21.8659 3.36523 24.0226 4.91104 25.5855 7.72158L35.0565 24.7566C36.5412 27.4266 36.7131 29.9874 35.5253 32.0016C34.3375 33.9846 32.0089 35.0932 28.9613 35.0932ZM19.4903 5.70736C18.0213 5.70736 16.5834 6.83158 15.4425 8.86142L5.98721 25.8965C4.92446 27.8014 4.75255 29.5502 5.48709 30.8149C6.22164 32.0797 7.84702 32.7667 10.035 32.7667H28.9769C31.1649 32.7667 32.7747 32.0797 33.5249 30.8149C34.275 29.5502 34.0875 27.817 33.0247 25.8965L23.5382 8.86142C22.3973 6.83158 20.9594 5.70736 19.4903 5.70736Z" fill="#E31E24"/>
            </svg>
        </div>

        <div class="modal-petition__body">
            <form action="{% url 'blog:create_complaint' %}" method="post" class="modal-petition__form d-flex flex-column gap-3 gap-xxl-4">
                {% csrf_token %}
                <input type="hidden" id="comment_id" name="{{complaint_form.object_id.name}}" />
                <input type="hidden" name="{{complaint_form.object_type.name}}" value="3" />
                <div class="articles-filter__item input">
                    <label class="label--light label--general">Тема жалобы</label>
                    {{complaint_form.title}}
                </div>
                <div class="input input--textarea mt-2">
                    <label class="label label--light label--general">Причина жалобы</label>
                    {{complaint_form.text}}
                </div>
                <button class="btn btn--empty">Отправить</button>
            </form>
        </div>

        </div>
    </div>
</div>

{% endblock %}

{% block extra_js %}
<script src="{% static "js/editor.js" %}"></script>
<!-- <script src="{% static "js/newFeedReplies.js" %}"></script> -->
<script src="{% static "js/onClickActive.js" %}"></script>
<script src="{% static "js/splide.min.js" %}"></script>
<script src="{% static "js/image-modal.js" %}"></script>
<script src="{% static "js/handleFileSelected.js" %}"></script>
<script src="{% static "js/add-form-banners.js" %}"></script>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    Splide.defaults = {
      perPage: 5,
      gap: "1.5rem",
      height: "219px",
      pagination: false,
      arrows: false,
      breakpoints: {
        1400: {
          perPage: 4,
          gap: "1rem",
          height: "179px",
          padding: { right: "1.5rem" },
        },
        768: {
          perPage: 3,
          gap: ".5rem",
          height: "108px",
          padding: { right: "1rem" },
        },
      },
    };
    document.querySelectorAll("#feed-image-slider").forEach(el => {
        new Splide(el).mount();
    })

  });
</script>

<script>
    // INIT text editor
    ClassicEditor
    .create( document.querySelector( '.editor' ), {
        toolbar: {
            items: [
                'bold',
                'italic',
                'strikethrough',
                'underline',
                '|',
                'numberedList',
                'bulletedList',
                '|',
                'link',
            ]
        },
    } )
    .then( editor => {
        window.editor = editor;
    } )
    .catch( handleSampleError );

    function handleSampleError( error ) {
        const issueUrl = 'https://github.com/ckeditor/ckeditor5/issues';

        const message = [
            'Oops, something went wrong!',
            `Please, report the following error on ${ issueUrl } with the build id "imv2hnq0y3vb-2iq20258slh1" and the error stack trace:`
        ].join( '\n' );

        console.error( message );
        console.error( error );
    }
</script>

<script>
    function newFeedReplies() {

    const feeds = document.querySelectorAll('.feed')

    feeds.forEach( el => { 
        const newRepliesBtn = el.querySelector('.js-newAnswerBtn')
        newRepliesBtn?.addEventListener('click', function(event) { 
            event.preventDefault()
            this.classList.add('pe-none')
            const parentId = newRepliesBtn.getAttribute('name');
            
            if(this.classList.contains('feed__mark')){
                
                const feedTextEdit = el.querySelector('.feed__text').innerHTML
                createReplies(el, "Оставить комментарий", "Сохранить", parentId, feedTextEdit)
                addBanners(el)

            } else { 
                createReplies(el, "Оставить комментарий", "Отправить комментарий", parentId) 
                addBanners(el)
            }
            
        }, { once: true } )
    })

    }

    function createReplies(parent, placeholder, button, parentId, value = '') {

    //CREATE text editor
    const replies = document.createElement("div");
    replies.classList.add("feed-replies", "my-2");

    replies.innerHTML = `
        <form action="{% url 'chats:create_conversation_comment' %}" method="post" name="comment-form" enctype="multipart/form-data">
            <textarea name="text" class="editor" placeholder="${placeholder}">${value}</textarea>
            <input type="hidden" name="post" value="{{post.id}}" />
            <input type="hidden" name="parent" value="${parentId}" />
            {% csrf_token %}
            <div class="profile__images profile__products-images banners__row mt-3">
                <div class="banners banners__pic position-relative m-0">
                    <div class="input image input--image profile__input profile__image products__image profile__products-image profile__products-input">
                        <img src="{% static 'img/gallery-add.svg' %}" alt="logo" class="position-absolute top-50 start-50 translate-middle"/>
                        <input type="file" name="images" id="products__file-input" class="file-input profile__file-input products__file-input" onchange="handleFileSelected(this)"/>
                    </div>
                </div>

                <div class="profile__products-plus banners__plus">
                    <svg role="button" class="banners__plus-image hover-red" viewBox="0 0 26 26" fill="none"xmlns="http://www.w3.org/2000/svg" >
                        <path d="M12.9993 24.6452C6.57518 24.6452 1.35352 19.4235 1.35352 12.9993C1.35352 6.57518 6.57518 1.35352 12.9993 1.35352C19.4235 1.35352 24.6452 6.57518 24.6452 12.9993C24.6452 19.4235 19.4235 24.6452 12.9993 24.6452ZM12.9993 2.97852C7.47435 2.97852 2.97852 7.47435 2.97852 12.9993C2.97852 18.5243 7.47435 23.0202 12.9993 23.0202C18.5243 23.0202 23.0202 18.5243 23.0202 12.9993C23.0202 7.47435 18.5243 2.97852 12.9993 2.97852Z" fill="#1560BD"/>
                        <path d="M17.3327 13.8125H8.66602C8.22185 13.8125 7.85352 13.4442 7.85352 13C7.85352 12.5558 8.22185 12.1875 8.66602 12.1875H17.3327C17.7769 12.1875 18.1452 12.5558 18.1452 13C18.1452 13.4442 17.7769 13.8125 17.3327 13.8125Z" fill="#1560BD" />
                        <path d="M13 18.1452C12.5558 18.1452 12.1875 17.7769 12.1875 17.3327V8.66602C12.1875 8.22185 12.5558 7.85352 13 7.85352C13.4442 7.85352 13.8125 8.22185 13.8125 8.66602V17.3327C13.8125 17.7769 13.4442 18.1452 13 18.1452Z" fill="#1560BD" />
                    </svg>
                </div>
            </div>


            <input type="submit" value="${button}" class="btn btn--base mt-3">
        </form>
    `;

    parent.insertAdjacentElement('beforeend', replies)


    // INIT text editor
    ClassicEditor
        .create( parent.querySelector( '.editor' ), {
            toolbar: {
                items: [
                    'bold',
                    'italic',
                    'strikethrough',
                    'underline',
                    '|',
                    'numberedList',
                    'bulletedList',
                    '|',
                    'link',
                ]
            },
        } )
        .then( editor => {
            window.editor = editor;
        } )
        .catch( handleSampleError );

        function handleSampleError( error ) {
            const issueUrl = 'https://github.com/ckeditor/ckeditor5/issues';

            const message = [
                'Oops, something went wrong!',
                `Please, report the following error on ${ issueUrl } with the build id "imv2hnq0y3vb-2iq20258slh1" and the error stack trace:`
            ].join( '\n' );

            console.error( message );
            console.error( error );
        }
    }

    function addBanners(parent){

    const bannersContainer = parent.querySelector(".banners__row");
    const bannersAddBtn = parent.querySelector(".banners__plus");

    const addBannersItem = () => {

        const newBannersItem = document.createElement("div");
        newBannersItem.classList.add(
            "banners", "banners__pic", "position-relative", "m-0"
        );

        newBannersItem.innerHTML = `
        <div class="input image input--image profile__input profile__image products__image profile__products-image profile__products-input">
            <img src="{% static 'img/gallery-add.svg' %}" alt="logo" class="position-absolute top-50 start-50 translate-middle"/>
            <input type="file" name="images" id="products__file-input" class="file-input profile__file-input products__file-input" onchange="handleFileSelected(this)"/>

            <i class="tag-close">
            <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M10 20C4.48372 20 0 15.5163 0 10C0 4.48372 4.48372 0 10 0C15.5163 0 20 4.48372 20 10C20 15.5163 15.5163 20 10 20Z" fill="#E31E24"></path>
                <path d="M13.1289 7.86591L7.86671 13.1281C7.59702 13.3978 7.14974 13.3978 6.88005 13.1281C6.61036 12.8584 6.61036 12.4111 6.88005 12.1414L12.1422 6.87925C12.4119 6.60956 12.8592 6.60956 13.1289 6.87925C13.3986 7.14893 13.3986 7.59622 13.1289 7.86591Z" fill="#FAFAFA"></path>
                <path d="M13.1289 13.1247C12.8592 13.3943 12.4119 13.3943 12.1422 13.1247L6.88005 7.86247C6.61036 7.59278 6.61036 7.1455 6.88005 6.87581C7.14974 6.60612 7.59702 6.60612 7.86671 6.87581L13.1289 12.138C13.3986 12.4077 13.3986 12.855 13.1289 13.1247Z" fill="#FAFAFA"></path>
            </svg>
            </i>
        </div>
        `;

        bannersContainer.insertBefore(newBannersItem, bannersAddBtn);

        const tagClose = newBannersItem.querySelector(".tag-close");
        tagClose.addEventListener("click", () => removeBannersItem(newBannersItem));


    };

    bannersAddBtn.addEventListener("click", () => { addBannersItem() });

    const removeBannersItem = (item) => { item.remove(); };

    }

    newFeedReplies()
</script>

<script>
    let all = $(".js-newReportBtn").click(function() {
        let postId = $(this).data('post-id');
        let commentId = $(this).data('comment-id');
        $('#post_id').val(postId);
        $('#comment_id').val(commentId);
    });


</script>
    <script>
        const buttonReload = document.querySelector('.discourse-comments__controls__icon--reload');
        buttonReload.addEventListener('click', () => {
            window.location.reload();
        })
    </script>

    <script>
        const buttonNewComments = document.querySelector('.discourse-comments__controls__icon--count');
        function getCommentsId() {
            let comments_id = [];
            const comments = document.querySelectorAll('.comment');
            comments.forEach((el) => {
                comments_id.push(el.dataset.commentId);
            })
            return comments_id;
        }

        buttonNewComments.addEventListener('click', () => {
            const countComments = buttonNewComments.querySelector('span').textContent;
            if (countComments > 0) {
                buttonNewComments.disabled = true;
                getNewComments();
            }
        })

        function getNewComments() {
            $.ajax({
                type: 'post',
                headers: { 'X-CSRFToken': '{{ csrf_token }}' },
                url: `/new-comments/{{ post.pk }}/`,
                data: {'objects_id': getCommentsId(), 'object_type': '3'},
                dataType: 'html',
                success: function(response) {
                    const countComments = buttonNewComments.querySelector('span');
                    try {
                        countComments.textContent = countComments.textContent - 1;
                        $('#list-comments').append(response);
                        Splide.defaults = {
                            perPage: 5,
                            gap: "1.5rem",
                            height: "219px",
                            pagination: false,
                            arrows: false,
                            breakpoints: {
                                1400: {
                                    perPage: 4,
                                    gap: "1rem",
                                    height: "179px",
                                    padding: {right: "1.5rem"},
                                },
                                768: {
                                    perPage: 3,
                                    gap: ".5rem",
                                    height: "108px",
                                    padding: {right: "1rem"},
                                },
                            },
                        };
                        let sliders = document.querySelectorAll("#feed-image-slider");
                        let slider = sliders[sliders.length - 1];
                        new Splide(slider).mount();

                        const commentsElems = document.querySelector('#list-comments').querySelectorAll('.discourse__item');
                        commentsElems[commentsElems.length - 1].scrollIntoView();
                        getNewCountComments();
                    } catch (e) {
                        getNewCountComments();
                    } finally {
                        buttonNewComments.disabled = false;
                    }
                },
                error: function (xhr, status, error) {
                    console.log('Произошла ошибка: ' + error);
                    buttonNewComments.disabled = false;
                },
            })
        }

        function getNewCountComments() {
            $.ajax({
                type: 'post',
                headers: { 'X-CSRFToken': '{{ csrf_token }}' },
                url: `/new-comments-count/{{ post.pk }}/`,
                data: {'objects_id': getCommentsId(), 'object_type': '3'},
                dataType: 'json',
                success: function(response) {
                    if (response['status'] === 'success') {
                        const countComments = buttonNewComments.querySelector('span');
                        countComments.textContent = response['data'];
                    }
                },
                error: function (xhr, status, error) {
                    alert('Произошла ошибка: ' + error);
                },
            })
        }

        let chatInterval;

        window.onload = function() {
            chatInterval = window.setInterval(function () {
                getNewCountComments();
            }, 10000);
        }

        window.addEventListener("beforeunload", function() {
            window.clearInterval(chatInterval);
        });
    </script>
{% endblock %}