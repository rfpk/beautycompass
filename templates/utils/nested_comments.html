{% load bleach_tags %}

{% for comment in comments %}
    {% if comment.parent.pk == parent %}
        <div class="feed feed-answer">
            <div class="feed__row">
                <div class="feed__user align-items-center">
                    <a href="{% url 'profile:author-profile' comment.author.id %}" class="feed__avatar">
                        {% if comment.author.profile.avatar %}
                            <img src="{{comment.author.profile.avatar.url}}" alt="avatar" />
                        {% endif %}
                        {% if comment.profile.avatar %}
                            <img src="{{comment.profile.avatar.url}}" alt="avatar" />
                        {% endif %}
                    </a>
                <div class="feed__info">
                    <a href="{% url 'profile:author-profile' comment.author.id %}" class="feed__name">{{comment.author.profile.first_name}} {{comment.author.profile.last_name_slice}}.</a>
                    <div class="d-flex align-items-center gap-2">
                        <div class="feed__date">{{comment.created_at|date:'d.m.Y'}}</div>
                    </div>
                </div>
                </div>
                <div class="feed__text d-flex flex-column align-items-start gap-1 gap-lg-2 dark-semi mt-2 mb-3">
                    <span class="feed__text feed__text--preview">
                        {{comment.text|bleach}}
                    </span>
                </div>
                {% if type == 'conversation' %}
                    {% if comment.comment_conversation_images %}
                        <section
                            id="feed-image-slider"
                            class="feed__splide splide"
                            aria-label="Feed slides"
                        >
                            <div class="splide__track">
                                <div class="splide__list">
                                    {% for photo in comment.comment_conversation_images.all %}
                                        <div class="splide__slide">
                                            <img
                                                src="{{photo.image.url}}"
                                                alt="review-photo"
                                                data-modal-image
                                            />
                                        </div>
                                    {% endfor %}
                                </div>
                            </div>
                        </section>
                    {% endif %}
                {% else %}
                    {% if comment.photos %}
                    <section
                        id="feed-image-slider"
                        class="feed__splide splide"
                        aria-label="Feed slides"
                    >
                        <div class="splide__track">
                            <div class="splide__list">
                                {% for photo in comment.photos.all %}
                                    <div class="splide__slide">
                                        <img
                                            src="{{photo.photo.url}}"
                                            alt="review-photo"
                                            data-modal-image
                                        />
                                    </div>
                                {% endfor %}
                            </div>
                        </div>
                    </section>
                {% endif %}
                {% endif %}

                <div class="feed__actions justify-content-between">
                    <button
                    type="button"
                    class="feed__action social-count__icon social-count__icon--small social-count__icon--like" onclick="onClickActive(this)"
                    >
                        <svg xmlns="http://www.w3.org/2000/svg" width="18px" height="19px" viewBox="0 0 22.2825 21.6998">
                            <path fill="#1560BD" d="M15.736 21.6998l-4.08184 0c-0.601234,0 -1.91179,-0.182397 -2.60994,-0.880805l-2.29113 -1.76914c-0.392855,0.984735 -1.29445,1.46905 -2.72504,1.46905l-1.07411 0c-1.9874,0 -2.95394,-0.934589 -2.95394,-2.84664l0 -10.5263c0,-1.91205 0.966547,-2.84638 2.95394,-2.84638l1.07411 0c1.52595,0 2.44988,0.551347 2.79675,1.67301l3.19688 -4.75635c0.676843,-1.00968 2.15888,-1.49321 3.31874,-1.05281 1.34277,0.440402 2.20201,1.9227 1.9014,3.29769l-0.526404 3.38369c-0.0106528,0.0750893 -0.0106528,0.182397 0.0644365,0.268399 0.0537837,0.0537837 0.128873,0.0860019 0.214875,0.0860019l4.29672 0c1.05255,0 1.96557,0.440402 2.50263,1.20299 0.526404,0.741019 0.633712,1.71874 0.289964,2.66398l-2.56707 7.81942c-0.397531,1.55739 -2.05183,2.81416 -3.78097,2.81416zm-8.75427 -4.51445l3.12595 2.42c0.268399,0.257746 0.945241,0.472621 1.54648,0.472621l4.08184 0c0.966547,0 2.00844,-0.773497 2.22332,-1.64339l2.59954 -7.89477c0.171744,-0.472621 0.139526,-0.90237 -0.0860019,-1.2139 -0.23618,-0.332835 -0.66593,-0.526145 -1.19233,-0.526145l-4.29646 0c-0.558623,0 -1.07437,-0.23644 -1.42877,-0.644624 -0.365053,-0.418837 -0.526145,-0.97746 -0.440402,-1.55739l0.537057 -3.44813c0.129133,-0.601494 -0.279051,-1.27808 -0.859239,-1.47139 -0.526404,-0.193569 -1.20299,0.0857421 -1.43943,0.42949l-4.37155 6.50471 0 8.57291zm-4.0278 -11.2746c-1.17103,0 -1.34277,0.279311 -1.34277,1.23521l0 10.5263c0,0.956154 0.171744,1.23547 1.34277,1.23547l1.07411 0c1.17077,0 1.34251,-0.279311 1.34251,-1.23547l0 -10.5263c0,-0.955894 -0.171744,-1.23521 -1.34251,-1.23521l-1.07411 0z"/>
                            <path class="icon-inner" fill="none" d="M2.77908 5.68106c-1.31289,0 -1.50542,0.289185 -1.50542,1.2786l0 10.8963c0,0.989671 0.19253,1.27886 1.50542,1.27886l1.20455 0c1.31263,0 1.50516,-0.289185 1.50516,-1.27886l0 -10.8963c0,-0.989412 -0.19253,-1.2786 -1.50516,-1.2786l-1.20455 0z"/>
                            <path class="icon-inner" fill="none" d="M6.98174 17.1853l3.23378 2.56083c0.270477,0.261124 0.953036,0.479116 1.55921,0.479116l4.11536 -0.000259824c0.974342,0.000259824 2.02481,-0.78415 2.24177,-1.66625l2.62085 -8.00623c0.173043,-0.479376 0.140825,-0.915102 -0.0865215,-1.23105 -0.238259,-0.337252 -0.671646,-0.533679 -1.20221,-0.533679l-4.33205 0c-0.563299,0 -1.08321,-0.239818 -1.44047,-0.653718 -0.368171,-0.424553 -0.530302,-0.99123 -0.44404,-1.57921l0.541474 -3.49698c0.130172,-0.609808 -0.28139,-1.296 -0.866255,-1.49217 -0.530821,-0.196167 -1.29964,0.151737 -1.53816,0.500162l-3.5188 5.23053 -0.883923 1.31601c0,2.08379 0,3.2899 0,1.50724l0 4.21903c0,0.782591 0,1.33758 0,2.84664z"/>
                        </svg> 
                        <span class="dark-semi">15</span>
                    </button>
                </div>

                {% if comment.profile.user == user or comment.author.profile.user == user %}
                    <a href="#" class="feed__mark js-newAnswerBtn" name="{{comment.id}}">
                        <svg width="39" height="38" viewBox="0 0 39 38" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M9.43976 30.5371C8.48729 30.5371 7.59729 30.2092 6.95711 29.6002C6.14517 28.8351 5.75482 27.6797 5.89535 26.4305L6.47307 21.3716C6.58237 20.4191 7.16009 19.1543 7.8315 18.4673L20.6507 4.89862C23.8516 1.51035 27.1931 1.41667 30.5813 4.61757C33.9696 7.81847 34.0633 11.1599 30.8624 14.5482L18.0432 28.1169C17.3874 28.8195 16.1695 29.4753 15.217 29.6314L10.1892 30.4902C9.9238 30.5058 9.68958 30.5371 9.43976 30.5371ZM25.6629 4.60195C24.4606 4.60195 23.4144 5.35143 22.3527 6.47565L9.53344 20.06C9.22116 20.3879 8.86204 21.1686 8.79958 21.6214L8.22185 26.6804C8.1594 27.1956 8.28431 27.6172 8.56537 27.8827C8.84642 28.1481 9.268 28.2418 9.78327 28.1637L14.811 27.3049C15.2638 27.2269 16.0133 26.8209 16.3256 26.493L29.1448 12.9243C31.081 10.8632 31.7836 8.9583 28.9575 6.3039C27.7083 5.10161 26.6309 4.60195 25.6629 4.60195Z" fill="#1560BD"/>
                            <path d="M27.8653 17.1558C27.8341 17.1558 27.7872 17.1558 27.756 17.1558C22.8844 16.6718 18.9652 12.9712 18.2158 8.13084C18.1221 7.49066 18.5593 6.89732 19.1995 6.78803C19.8396 6.69434 20.433 7.13154 20.5423 7.77172C21.1356 11.5503 24.196 14.4546 28.0058 14.8293C28.646 14.8918 29.1144 15.4695 29.052 16.1097C28.9739 16.703 28.4586 17.1558 27.8653 17.1558Z" fill="#1560BD"/>
                            <path d="M33.5773 35.5804H5.47184C4.83166 35.5804 4.30078 35.0495 4.30078 34.4093C4.30078 33.7692 4.83166 33.2383 5.47184 33.2383H33.5773C34.2175 33.2383 34.7484 33.7692 34.7484 34.4093C34.7484 35.0495 34.2175 35.5804 33.5773 35.5804Z" fill="#1560BD"/>
                        </svg>
                    </a>
                {% else %}
                    <a href="#" class="feed__mark js-newReportBtn" type="button" data-bs-toggle="modal" data-bs-target="#modal-petition" type="button" data-bs-toggle="modal" data-bs-target="#modal-petition" name="{{comment.id}}">
                        <svg width="39" height="38" viewBox="0 0 39 38" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M19.4886 23.5222C18.8478 23.5222 18.3164 22.9914 18.3164 22.3512V14.5441C18.3164 13.9039 18.8478 13.373 19.4886 13.373C20.1293 13.373 20.6607 13.9039 20.6607 14.5441V22.3512C20.6607 22.9914 20.1293 23.5222 19.4886 23.5222Z" fill="#E31E24"/>
                            <path d="M19.4886 28.5974C19.3949 28.5974 19.2855 28.5818 19.1761 28.5662C19.0823 28.5506 18.9885 28.5194 18.8948 28.4725C18.801 28.4413 18.7072 28.3945 18.6134 28.332C18.5353 28.2695 18.4572 28.2071 18.379 28.1446C18.0977 27.848 17.9258 27.442 17.9258 27.036C17.9258 26.6301 18.0977 26.2241 18.379 25.9274C18.4572 25.865 18.5353 25.8025 18.6134 25.74C18.7072 25.6776 18.801 25.6307 18.8948 25.5995C18.9885 25.5527 19.0823 25.5214 19.1761 25.5058C19.3792 25.459 19.598 25.459 19.7856 25.5058C19.895 25.5214 19.9888 25.5527 20.0825 25.5995C20.1763 25.6307 20.2701 25.6776 20.3638 25.74C20.442 25.8025 20.5201 25.865 20.5983 25.9274C20.8796 26.2241 21.0515 26.6301 21.0515 27.036C21.0515 27.442 20.8796 27.848 20.5983 28.1446C20.5201 28.2071 20.442 28.2695 20.3638 28.332C20.2701 28.3945 20.1763 28.4413 20.0825 28.4725C19.9888 28.5194 19.895 28.5506 19.7856 28.5662C19.6918 28.5818 19.5824 28.5974 19.4886 28.5974Z" fill="#E31E24"/>
                            <path d="M28.9613 35.0932H10.0194C6.97181 35.0932 4.64315 33.9846 3.45537 31.986C2.28323 29.9874 2.43951 27.411 3.92423 24.741L13.3952 7.72158C14.958 4.91104 17.1148 3.36523 19.4903 3.36523C21.8659 3.36523 24.0226 4.91104 25.5855 7.72158L35.0565 24.7566C36.5412 27.4266 36.7131 29.9874 35.5253 32.0016C34.3375 33.9846 32.0089 35.0932 28.9613 35.0932ZM19.4903 5.70736C18.0213 5.70736 16.5834 6.83158 15.4425 8.86142L5.98721 25.8965C4.92446 27.8014 4.75255 29.5502 5.48709 30.8149C6.22164 32.0797 7.84702 32.7667 10.035 32.7667H28.9769C31.1649 32.7667 32.7747 32.0797 33.5249 30.8149C34.275 29.5502 34.0875 27.817 33.0247 25.8965L23.5382 8.86142C22.3973 6.83158 20.9594 5.70736 19.4903 5.70736Z" fill="#E31E24"/>
                        </svg>
                    </a>
                {% endif %}
            </div>
        </div>
        <br />
        {% include "utils/nested_comments.html" with comments=comments parent=comment.pk %}
    {% endif %}
{% endfor %}
